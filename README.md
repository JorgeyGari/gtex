# GTEx / GDC slide downloader

This repository contains small scripts to prepare and download whole-slide images (WSI) from GTEx and TCGA/GDC for research and analysis. Main entry points:

- `main.py` — interactive orchestrator that runs URL preparation and the GTEx/GDC download steps.
- `gtex.py` — GTEx downloader (consumes a URL list produced by `prepare_urls.py`).
- `gdc.py` — TCGA (GDC) slides querier + downloader (uses `gdc-api-wrapper` for downloads).
- `prepare_urls.py` — helper to generate GTEx URL lists and filtered metadata.

## Quick summary

Use `uv` (Astral UV) to create an isolated virtual environment, install the right Python version, and install dependencies from the lockfile. This keeps the workflow reproducible and simple for collaborators.

## Setup (recommended with UV)

1. Clone the repository and enter it:

```bash
git clone <your-repo-url>
cd <your-repo-name>
```

2. Install all dependencies and create the `.venv` automatically:

```bash
uv sync
```

`uv sync` will create the `.venv` directory, ensure the Python version from `.python-version` is present (or prompt to install it), and install the exact packages listed in `uv.lock`.

3. Run scripts inside the managed environment with `uv run` — no need to activate the venv manually. Example:

```bash
uv run python main.py
# or run an individual script
uv run python gdc.py --dry-run --max 2
```

You can also run tests or other commands the same way:

```bash
uv run pytest
```

## Files to commit & ignore

Commit these files (source of truth):

- `pyproject.toml` — dependency and project metadata
- `uv.lock` — locked, exact package versions for reproducibility
- `.python-version` — Python version pin for UV
- `.gitignore` — should include `.venv/`

Do NOT commit:

- `.venv/` — local virtual environment (generated by `uv sync`)
- `__pycache__/` and other generated artifacts

If you previously had a `requirements.txt` it is optional; prefer `pyproject.toml` + `uv.lock` with UV for reproducible installs.

This will error if `pyproject.toml` and the lockfile are out of sync — good for enforcing reproducible builds.

## Running the downloader (tips)

- `gdc.py --dry-run` queries GDC and prints counts/sizes without downloading. Use this to preview what will be downloaded.
- `gdc.py -y --max N` runs non-interactively and limits to `N` files.
- `main.py` is interactive by default; it can call `prepare_urls.py` (to build GTEx URL lists) and then call `gtex.py` and/or `gdc.py`.

Be careful when running non-dry runs: the dataset sizes can be large. Make sure you have sufficient disk space and bandwidth.

## Helper scripts

This repository includes small convenience wrappers in `scripts/` to make common workflows easier:

- `scripts/run.sh` — a POSIX shell wrapper (Linux/macOS) for common `uv` commands (sync, run `main.py`, `gdc.py` dry-run, pytest, and a shell inside the uv-managed environment).
- `scripts/run.ps1` — a PowerShell counterpart for Windows users providing the same set of commands.

Examples (Linux/macOS):

```bash
./scripts/run.sh sync
./scripts/run.sh main
./scripts/run.sh gdc-dry 5
./scripts/run.sh gdc 2
```

Examples (Windows PowerShell):

```powershell
./scripts/run.ps1 sync
./scripts/run.ps1 main
./scripts/run.ps1 gdc-dry 5
./scripts/run.ps1 gdc 2
```

Both scripts simply call `uv`/`uv run ...` under the hood so they don't require activating the virtual environment manually.

## Notes

- This repo uses `gdc-api-wrapper` for downloads; the package is referenced in the lockfile / dependency configuration.
- If you see import errors locally (for example `ModuleNotFoundError: No module named 'requests'`), ensure you ran `uv sync` and use `uv run` to execute scripts.
 